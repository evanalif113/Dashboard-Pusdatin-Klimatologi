<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!--reference for favicon-->
    <link rel="icon" type="image/png" href="./img/logo.png">
    <!--reference to CSS-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="./style/style.css">
    <!-- include to use jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!--include icons from fontawesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!--Judul Website-->
    <title>Pusat Data Iklim Jerukagung Seismologi</title>
  </head>
  <body>
    <!--MAIN PAGE HOMEs-->
    <div class="mainpage">
        <div class="topnav">
          <a class="active">Beranda</a>
          <a href="./research.html">Riset</a>
          <a href="#" id="dataLink">Data</a>
          <a href="./team.html">Tim Kami</a>
          <a href="./charts.html">Grafik</a>
          <img src="./img/logo.png" alt="Logo" class="logo"> <!-- Menambahkan logo -->
        </div>
      <h1 class="mainpagetext">Selamat Datang di Pusat Data Iklim Jerukagung</h1>
      <p class="mainpagetext">Penelitian dan Pengembangan Stasiun Iklim Jerukagung Seismologi</p>
    </div>
    <!-- Pop-up Login -->
          <!-- Modal Bootstrap -->
      <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
              <h5 class="modal-title" id="loginModalLabel">Login</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" placeholder="Email">
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" placeholder="Password">
              </div>
              <p id="error-message" class="text-danger"></p>
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="loginBtn">Login</button>
            </div>
          </div>
        </div>
      </div>
    <script type="module">
        import { loginUser } from './script/auth.js';

        // Check if the user is logged in
        let isLoggedIn = false;

        // Get modal elements using Bootstrap modal component
        var loginModal = new bootstrap.Modal(document.getElementById("loginModal"));
        var loginBtn = document.getElementById("loginBtn");
        var errorMessage = document.getElementById("error-message");

        // Handle the "Data" link click event
        document.getElementById("dataLink").addEventListener("click", function(event) {
          event.preventDefault();
          if (isLoggedIn) {
            // If logged in, redirect to the Data page
            window.location.href = "./data.html";
          } else {
            // If not logged in, show the login modal
            loginModal.show();
          }
        });

        // Handle login button click event
        loginBtn.onclick = async function() {
          var email = document.getElementById("email").value;
          var password = document.getElementById("password").value;

          try {
            const userCredential = await loginUser(email, password);
            alert("Login berhasil!");
            isLoggedIn = true; // Set logged in status
            loginModal.hide(); // Close the modal after successful login
            window.location.href = "./data.html"; // Redirect to the data page
          } catch (error) {
            // Login failed, show error message
            errorMessage.textContent = "Gagal login: " + error.message;
          }
        }

    </script>

  </body>
  <footer>
    <button type="button" class="btn btn-success" style="font-size: 18px" 
    onclick="sendEmail()">Kontak Jerukagung Seismologi
    </button>
  </footer>  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
</html>
