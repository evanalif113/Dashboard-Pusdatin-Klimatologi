<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!--reference for favicon-->
    <link rel="icon" type="image/png" href="./Logo.png">
    <!--reference to CSS-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="./style/style.css">
    <!-- include to use jquery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!--include icons from fontawesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!--Judul Website-->
    <title>Pusat Data Iklim Jerukagung Seismologi</title>
  </head>
  <body>
    <!--MAIN PAGE HOMEs-->
    <div class="mainpage">
      <div class="container">
        <div class="topnav">
          <a class="active">Home</a>
          <a href="./404.html">Research</a>
          <a href="#" id="dataLink">Data</a>
          <a href="./team.html">Our Team</a>
          <a href="./contact.html">Contact</a>
          <a href="./charts.html">More</a>
        </div>
      </div>
      <h1 class="mainpagetext">Selamat Datang di Pusat Data Iklim Jerukagung</h1>
      <p class="mainpagetext">Penelitian dan Pengembangan Stasiun Iklim Jerukagung Seismologi</p>
    </div>
    <!-- Pop-up Login -->
    <div id="loginModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="loginBtn">Login</button>
        <p id="error-message" style="color: red;"></p>
      </div>
    </div>

    <script type="module">
      import { loginUser } from './script/auth.js';

      // Check if the user is logged in
      let isLoggedIn = false;

      // Get modal elements
      var modal = document.getElementById("loginModal");
      var closeModal = document.getElementsByClassName("close")[0];
      var loginBtn = document.getElementById("loginBtn");
      var errorMessage = document.getElementById("error-message");

      // Handle the "Data" link click event
      document.getElementById("dataLink").addEventListener("click", function(event) {
        event.preventDefault();
        if (isLoggedIn) {
          // If logged in, redirect to the Data page
          window.location.href = "./data.html";
        } else {
          // If not logged in, show the login modal
          modal.style.display = "block";
        }
      });

      // Close modal when "x" is clicked
      closeModal.onclick = function() {
        modal.style.display = "none";
      }

      // Close modal when clicked outside of it
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

      // Handle login
      loginBtn.onclick = async function() {
        var email = document.getElementById("email").value;
        var password = document.getElementById("password").value;

        try {
          const userCredential = await loginUser(email, password);
          alert("Login berhasil!");
          modal.style.display = "none";
          isLoggedIn = true; // Set logged in status
          window.location.href = "./data.html"; // Redirect to the data page
        } catch (error) {
          // Login failed, show error message
          errorMessage.textContent = "Gagal login: " + error.message;
        }
      }
    </script>

  </body>
  <footer>
    <button type="button" class="btn btn-success" style="font-size: 18px" 
    onclick="sendEmail()">Kontak Jerukagung Seismologi
    </button>
  </footer>  
  <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
</html>
